<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #121212;  /* Color de fondo oscuro */
            color: #ffffff;  /* Color de texto claro */
            font-family: 'Arial', sans-serif;
        }

        .player-container {
            max-width: 70%;
            margin: auto;
            margin-top: 50px;
            background-color: #212121;  /* Color de fondo del contenedor */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);  /* Sombra con color claro */
        }

        #mediaPlayer {
            display: none;
            width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        #currentSong, #currentTime {
            margin-bottom: 0;
            font-size: 16px;
            color: #ffffff;  /* Color de texto claro */
        }

        .title{
            color: #253bff;
        }
        .btn-group {
            margin-top: 10px;
        }

        .form-group {
            margin-top: 15px;
        }

        label {
            font-weight: bold;
            color: #ffffff;  /* Color de texto claro */
        }

        select {
            height: 150px;
            background-color: #343a40;  /* Color de fondo más oscuro para la lista de reproducción */
            color: #ffffff;  /* Color de texto claro */
        }

        /* Botones estilo dark */
        .btn-dark {
            background-color: #343a40;
            color: #ffffff;
            border: 1px solid #ffffff;
        }

        /* Botones estilo dark cuando están activos */
        .btn-dark.active, .btn-dark:active {
            background-color: #212529;
            border: 1px solid #ffffff;
        }
    </style>
    <title>Reproductor de Lista de Reproducción</title>
</head>
<body>
    <div class="container player-container">
        <h3 class="title mt-4 mb-4">Reproductor de Lista de Reproducción</h3>

        <video id="mediaPlayer" controls></video>
        <p id="currentSong" class="mt-3 mb-2">Nombre del audio/video</p>
        <p id="currentTime" class="mb-3">Tiempo actual / Duración total</p>

        <div class="btn-group" role="group">
            <button type="button" class="btn btn-primary" onclick="addSong()">Añadir canción</button>
            <button type="button" class="btn btn-primary" onclick="playPause()">Reproducir/Pausar</button>
            <button type="button" class="btn btn-primary" onclick="prevSong()">Anterior</button>
            <button type="button" class="btn btn-primary" onclick="nextSong()">Siguiente</button>
            <button type="button" class="btn btn-primary" onclick="toggleRandom()">Aleatorio</button>
            <button type="button" class="btn btn-primary" onclick="toggleSubtitles()">Subtítulos</button>
            <button type="button" class="btn btn-danger" onclick="removeSong()">Eliminar canción</button>
        </div>

        <div class="form-group mt-3">
            <label for="subtitleFile">Subtítulos:</label>
            <input type="file" class="form-control-file" id="subtitleFile">
        </div>

        <div class="form-group">
            <label for="playlist">Lista de reproducción:</label>
            <select class="form-control" id="playlist" multiple></select>
        </div>
    </div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // Lista de reproducción
    let playlist = [];
    let currentIndex = 0;
    let randomMode = false;
    let subtitlesEnabled = false;

    // Obtener elementos del DOM
    const mediaPlayer = document.getElementById('mediaPlayer');
    const currentSongElement = document.getElementById('currentSong');
    const currentTimeElement = document.getElementById('currentTime');
    const subtitleFileInput = document.getElementById('subtitleFile');
    const playlistSelect = document.getElementById('playlist');

    // Añadir canción a la lista de reproducción
    function addSong() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'audio/*,video/*';
    fileInput.onchange = function (event) {
        const file = event.target.files[0];
        if (file) {
            const listItem = document.createElement('option');
            listItem.text = file.name;

            const subtitleFile = subtitleFileInput.files[0];
            playlist.push({ file, subtitle: subtitleFile });
            playlistSelect.add(listItem);

            if (playlist.length === 1) {
                playSong(0);
            }
        }
    };
    fileInput.click();
}

    // Reproducir/Pausar canción
    function playPause() {
        if (mediaPlayer.paused) {
            mediaPlayer.play();
        } else {
            mediaPlayer.pause();
        }
    }

    function playSong(index) {
    currentIndex = index;
    const song = playlist[currentIndex];
    mediaPlayer.src = URL.createObjectURL(song.file);
    mediaPlayer.onloadedmetadata = function () {
        mediaPlayer.style.display = 'block';  // Mostrar el video cuando se carga
        if (subtitlesEnabled && song.subtitle) {
            const track = document.createElement('track');
            track.src = URL.createObjectURL(song.subtitle);
            track.kind = 'subtitles';
            track.srclang = 'es';
            mediaPlayer.appendChild(track);
        }
        mediaPlayer.play();
        currentSongElement.textContent = `Now Playing: ${song.file.name}`;
        updateTime();
    };
}
    // Actualizar tiempo actual
    function updateTime() {
        currentTimeElement.textContent = `${formatTime(mediaPlayer.currentTime)} / ${formatTime(mediaPlayer.duration)}`;
    }

    // Formatear tiempo en segundos a formato mm:ss
    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = Math.floor(seconds % 60);
        return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
    }

    // Anterior canción
    function prevSong() {
        currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
        playSong(currentIndex);
    }

    // Siguiente canción
    function nextSong() {
        if (randomMode) {
            currentIndex = Math.floor(Math.random() * playlist.length);
        } else {
            currentIndex = (currentIndex + 1) % playlist.length;
        }
        playSong(currentIndex);
    }

    // Activar/desactivar reproducción aleatoria
    function toggleRandom() {
        randomMode = !randomMode;
    }

    // Activar/desactivar subtítulos
    function toggleSubtitles() {
        subtitlesEnabled = !subtitlesEnabled;
        if (!subtitlesEnabled) {
            const tracks = mediaPlayer.getElementsByTagName('track');
            for (const track of tracks) {
                track.remove();
            }
        }
    }

    // Eliminar canción de la lista de reproducción
    function removeSong() {
        if (playlist.length > 0) {
            playlist.splice(currentIndex, 1);
            playlistSelect.remove(currentIndex);
            if (playlist.length > 0) {
                playSong(currentIndex);
            } else {
                mediaPlayer.src = '';
                mediaPlayer.style.display = 'none';  // Ocultar el video cuando no hay video cargado
                currentSongElement.textContent = 'Nombre del audio/video';
                currentTimeElement.textContent = 'Tiempo actual / Duración total';
            }
        }
    }

    // Eventos del reproductor
    mediaPlayer.addEventListener('timeupdate', updateTime);
    mediaPlayer.addEventListener('ended', nextSong);
</script>

</body>
</html>
